<app-main-layout *ngIf="user">
  <div class="mi-cuenta-container">
    <!-- Contenido principal con márgenes -->
    <div class="main-content-wrapper">
    <!-- Header Section -->
  <div class="header-section">
    <div class="avatar-container">
      <div class="avatar-circle">
        <span class="avatar-text">{{ user.nombre.charAt(0).toUpperCase() }}</span>
      </div>
    </div>
    <div class="header-text">
      <h1 class="main-title">Mi Cuenta</h1>
      <p class="subtitle">Gestiona tu información personal y revisa tus compras</p>
    </div>
  </div>

  <!-- Navigation Bar -->
  <div class="navigation-bar">
    <button class="nav-button" [class.active]="activeTab === 'perfil'" (click)="setActiveTab('perfil')">
      <i class="bi bi-person nav-icon"></i>
      <span class="nav-text">Perfil</span>
    </button>
    <button class="nav-button" [class.active]="activeTab === 'direcciones'" (click)="setActiveTab('direcciones')">
      <i class="bi bi-geo-alt nav-icon"></i>
      <span class="nav-text">Direcciones</span>
    </button>
    <button class="nav-button" [class.active]="activeTab === 'pedidos'" (click)="setActiveTab('pedidos')">
      <i class="bi bi-box nav-icon"></i>
      <span class="nav-text">Mis Pedidos</span>
    </button>
    <button class="nav-button" [class.active]="activeTab === 'pagos'" (click)="setActiveTab('pagos')">
      <i class="bi bi-credit-card nav-icon"></i>
      <span class="nav-text">Métodos de Pago</span>
    </button>
  </div>

  <!-- Main Content Area -->
  <div class="main-content">
    <!-- Información Personal Section -->
    <div class="info-card" *ngIf="activeTab === 'perfil'">
      <div class="card-header">
        <h2 class="card-title">Información Personal</h2>
        <p class="card-subtitle">Actualiza tu información personal y mantén tu perfil al día</p>
      </div>

      <form class="info-form" (ngSubmit)="saveChanges()">
        <div class="form-row">
          <div class="form-group">
            <label for="nombre" class="form-label">Nombre Completo</label>
            <input
              type="text"
              id="nombre"
              class="form-input"
              [(ngModel)]="userData.nombre"
              name="nombre"
              required>
          </div>
          <div class="form-group">
            <label for="email" class="form-label">Email</label>
            <input
              type="email"
              id="email"
              class="form-input"
              [(ngModel)]="userData.email"
              name="email"
              required>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="telefono" class="form-label">Teléfono</label>
            <input
              type="tel"
              id="telefono"
              class="form-input"
              [(ngModel)]="userData.telefono"
              name="telefono"
              placeholder="+57 300 123 4567">
          </div>
          <div class="form-group">
            <label for="fechaNacimiento" class="form-label">Fecha de Nacimiento</label>
            <input
              type="date"
              id="fechaNacimiento"
              class="form-input"
              [(ngModel)]="userData.fechaNacimiento"
              name="fechaNacimiento">
          </div>
        </div>

        <div class="form-actions">
          <button type="submit" class="save-button">
            Guardar Cambios
          </button>
        </div>
      </form>
    </div>

    <!-- Direcciones Section -->
    <div class="info-card" *ngIf="activeTab === 'direcciones'">
      <div class="card-header">
        <h2 class="card-title">Dirección de Entrega</h2>
        <p class="card-subtitle">Administra tus direcciones de entrega</p>
      </div>

      <!-- Lista de direcciones existentes -->
      <div class="direcciones-list" *ngIf="direcciones.length > 0">
        <div class="direccion-item" *ngFor="let direccion of direcciones">
          <div class="direccion-info">
            <p class="direccion-text"><strong>{{ direccion.direccion }}</strong></p>
            <p class="direccion-details">{{ direccion.ciudad }}, {{ direccion.departamento }} - {{ direccion.codigoPostal }}</p>
            <p class="direccion-details">{{ direccion.pais }}</p>
          </div>
          <div class="direccion-actions">
            <button class="btn-edit" (click)="editarDireccion(direccion)">
              <i class="bi bi-pencil"></i> Editar
            </button>
            <button class="btn-delete" (click)="eliminarDireccion(direccion.id!)">
              <i class="bi bi-trash"></i> Eliminar
            </button>
          </div>
        </div>
      </div>

      <!-- Formulario de dirección -->
      <form class="info-form" (ngSubmit)="guardarDireccion()" #direccionFormRef="ngForm">
        <div class="form-row-full">
          <div class="form-group">
            <label for="direccion" class="form-label">Dirección</label>
            <input
              type="text"
              id="direccion"
              class="form-input"
              [(ngModel)]="direccionForm.direccion"
              name="direccion"
              placeholder="Carrera 15 #45-20"
              required>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="ciudad" class="form-label">Ciudad</label>
            <input
              type="text"
              id="ciudad"
              class="form-input"
              [(ngModel)]="direccionForm.ciudad"
              name="ciudad"
              placeholder="Bogotá"
              required>
          </div>
          <div class="form-group">
            <label for="departamento" class="form-label">Departamento</label>
            <input
              type="text"
              id="departamento"
              class="form-input"
              [(ngModel)]="direccionForm.departamento"
              name="departamento"
              placeholder="Cundinamarca"
              required>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="codigoPostal" class="form-label">Código Postal</label>
            <input
              type="text"
              id="codigoPostal"
              class="form-input"
              [(ngModel)]="direccionForm.codigoPostal"
              name="codigoPostal"
              placeholder="110111">
          </div>
          <div class="form-group">
            <label for="pais" class="form-label">País</label>
            <input
              type="text"
              id="pais"
              class="form-input"
              [(ngModel)]="direccionForm.pais"
              name="pais"
              placeholder="Colombia"
              required>
          </div>
        </div>

        <div class="form-actions">
          <button type="submit" class="save-button">
            {{ editandoDireccion ? 'Actualizar Dirección' : 'Guardar Dirección' }}
          </button>
          <button type="button" class="cancel-button" *ngIf="editandoDireccion" (click)="inicializarFormularioDireccion()">
            Cancelar
          </button>
        </div>
      </form>
    </div>

    <div class="info-card" *ngIf="activeTab === 'pedidos'">
      <div class="card-header">
        <h2 class="card-title">Mis Pedidos</h2>
        <p class="card-subtitle">Revisa el historial de tus compras</p>
      </div>

      <div *ngIf="cargandoPedidos" class="loading-container">
        <p>Cargando pedidos...</p>
      </div>

      <div *ngIf="!cargandoPedidos && pedidos.length === 0" class="empty-state">
        <p>No tienes pedidos aún</p>
      </div>

      <div *ngIf="!cargandoPedidos && pedidos.length > 0" class="pedidos-list">
        <div class="pedido-item" *ngFor="let pedido of pedidos">
          <div class="pedido-header">
            <div class="pedido-info">
              <h3 class="pedido-numero">Pedido #{{ pedido.numeroVenta || pedido.id }}</h3>
              <p class="pedido-fecha">{{ formatearFecha(pedido.fechaVenta) }}</p>
            </div>
            <div class="pedido-estado">
              <span class="badge" [class]="obtenerEstadoBadge(pedido.estado)">
                {{ pedido.estado || 'PENDIENTE' }}
              </span>
            </div>
          </div>
          <div class="pedido-details">
            <div class="detail-row">
              <span class="detail-label">Método de pago:</span>
              <span class="detail-value">{{ pedido.metodoPago || 'N/A' }}</span>
            </div>
            <div class="detail-row">
              <span class="detail-label">Total:</span>
              <span class="detail-value total-amount">${{ pedido.total | number:'1.0-0' }}</span>
            </div>
            <div class="detail-row" *ngIf="pedido.detallesVenta && pedido.detallesVenta.length > 0">
              <span class="detail-label">Productos:</span>
              <span class="detail-value">{{ pedido.detallesVenta.length }} producto(s)</span>
            </div>
          </div>
          <div class="pedido-products" *ngIf="pedido.detallesVenta && pedido.detallesVenta.length > 0">
            <div class="product-item" *ngFor="let detalle of pedido.detallesVenta">
              <div class="product-name">{{ detalle.producto?.nombre || 'Producto' }}</div>
              <div class="product-qty">Cantidad: {{ detalle.cantidad }}</div>
              <div class="product-price">${{ detalle.subtotal | number:'1.0-0' }}</div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Métodos de Pago Section -->
    <div class="info-card" *ngIf="activeTab === 'pagos'">
      <div class="card-header">
        <h2 class="card-title">Métodos de Pago</h2>
        <p class="card-subtitle">Administra tus tarjetas y métodos de pago</p>
      </div>

      <!-- Lista de métodos de pago existentes -->
      <div class="metodos-pago-grid" *ngIf="metodosPago.length > 0">
        <div class="metodo-pago-card" *ngFor="let metodoPago of metodosPago">
          <div class="metodo-pago-header">
            <div class="tipo-tarjeta-badge" [style.background-color]="obtenerColorTipoTarjeta(metodoPago.tipoTarjeta)">
              {{ metodoPago.tipoTarjeta }}
            </div>
            <div class="principal-badge" *ngIf="metodoPago.principal">
              Principal
            </div>
          </div>
          <div class="metodo-pago-body">
            <div class="numero-tarjeta">{{ formatearNumeroTarjeta(metodoPago.numeroTarjeta) }}</div>
            <div class="fecha-expiracion">Expira {{ metodoPago.fechaExpiracion }}</div>
            <div class="nombre-titular">{{ metodoPago.nombreTitular }}</div>
          </div>
          <div class="metodo-pago-actions">
            <button class="btn-edit" (click)="editarMetodoPago(metodoPago)">
              Editar
            </button>
          </div>
        </div>
      </div>

      <!-- Área para agregar nueva tarjeta -->
      <div class="metodos-pago-grid">
        <div class="metodo-pago-card-add" (click)="inicializarFormularioMetodoPago()">
          <div class="add-card-icon">
            <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="3" y="4" width="18" height="12" rx="2" ry="2"></rect>
              <line x1="3" y1="10" x2="21" y2="10"></line>
            </svg>
          </div>
          <div class="add-card-text">Agregar nueva tarjeta</div>
          <button class="btn-add-card" type="button">
            <span>+</span> Agregar
          </button>
        </div>
      </div>

      <!-- Formulario de método de pago -->
      <form class="info-form" *ngIf="mostrarFormularioMetodoPago()" (ngSubmit)="guardarMetodoPago()" #metodoPagoFormRef="ngForm">
        <div class="form-row">
          <div class="form-group">
            <label for="tipoTarjeta" class="form-label">Tipo de Tarjeta</label>
            <select
              id="tipoTarjeta"
              class="form-input"
              [(ngModel)]="metodoPagoForm.tipoTarjeta"
              name="tipoTarjeta"
              required>
              <option value="">Seleccione un tipo</option>
              <option value="VISA">VISA</option>
              <option value="MASTERCARD">MASTERCARD</option>
              <option value="AMEX">AMEX</option>
              <option value="DINERS">DINERS</option>
            </select>
          </div>
          <div class="form-group">
            <label for="numeroTarjeta" class="form-label">Número de Tarjeta</label>
            <input
              type="text"
              id="numeroTarjeta"
              class="form-input"
              [(ngModel)]="metodoPagoForm.numeroTarjeta"
              name="numeroTarjeta"
              placeholder="1234 5678 9012 3456"
              maxlength="19"
              required>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="nombreTitular" class="form-label">Nombre del Titular</label>
            <input
              type="text"
              id="nombreTitular"
              class="form-input"
              [(ngModel)]="metodoPagoForm.nombreTitular"
              name="nombreTitular"
              placeholder="Juan Pérez"
              required>
          </div>
          <div class="form-group">
            <label for="fechaExpiracion" class="form-label">Fecha de Expiración</label>
            <input
              type="text"
              id="fechaExpiracion"
              class="form-input"
              [(ngModel)]="metodoPagoForm.fechaExpiracion"
              name="fechaExpiracion"
              placeholder="12/26"
              maxlength="5"
              pattern="(0[1-9]|1[0-2])\/([0-9]{2})"
              required>
            <small class="form-hint">Formato: MM/YY</small>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label class="checkbox-label">
              <input
                type="checkbox"
                [(ngModel)]="metodoPagoForm.principal"
                name="principal">
              <span>Establecer como método de pago principal</span>
            </label>
          </div>
        </div>

        <div class="form-actions">
          <button type="submit" class="save-button">
            {{ editandoMetodoPago ? 'Actualizar Método de Pago' : 'Guardar Método de Pago' }}
          </button>
          <button type="button" class="cancel-button" (click)="mostrarFormMetodoPago = false; inicializarFormularioMetodoPago()">
            Cancelar
          </button>
        </div>
      </form>
    </div>
    </div>
    </div> <!-- Cierre del main-content-wrapper -->
  </div> <!-- Cierre del mi-cuenta-container -->
</app-main-layout>
